# kb_cytoscape

This is a [KBase](https://kbase.us) module generated by the [KBase Software Development Kit (SDK)](https://github.com/kbase/kb_sdk).

You will need to have the SDK installed to use this module. [Learn more about the SDK and how to use it](https://kbase.github.io/kb_sdk_docs/).

You can also learn more about the apps implemented in this module from its [catalog page](https://narrative.kbase.us/#catalog/modules/kb_cytoscape) or its [spec file]($module_name.spec).

# Development Set up

The Perl SDK app accesses the ArangoDB at https://ci.kbase.us via the Relation Engine (RE) API, https://github.com/kbase/relation_engine. To mimic this set-up for local development, there is a docker-compose file that launches an ArangoDB instance, an `re_api` container with the relation engine API, and the Perl SDK app. This can be used to test data fetches, run tests, and so on.

At present there is no connection to the callback server that apps use for (e.g.) saving reports or accessing the user workspace.

To set up a development environment locally, open a shell in the `kb_cytoscape` directory.

Pull the relation engine repo:

```sh
git clone https://github.com/kbase/relation_engine.git
```

Running `make docker-shell` will create an interactive docker set up with access to ArangoDB, Python relation engine, and Perl SDK app containers. The full ArangoDB schema will be loaded automatically, and a test dataset (in `relation_engine/spec/test/djornl/test_data`) will be loaded into the database (see `scripts/start_re_server_load_data.sh`). You can use Docker Desktop to create shells into any of the containers or to access them through the browser.

## Loading another DJORNL dataset into Arango

After running `make docker-shell` to bring up the development environment, data can be loaded into Arango by accessing the python `re_api` container and running

```sh
RES_ROOT_DATA_PATH=/path/to/data/dir python -m importers.djornl.parser
```

with the appropriate path to the dataset to be loaded. You may want to edit the `docker-compose.override.yaml` file to add the data directory to the python container.

Note that there is no mechanism to delete a specific dataset (or part thereof), so data removal should be done by accessing the ArangoDB container and using either the web interface or a shell into the container.

## Signalling that data is loaded

The presence or absence of a `db_done` file in the `shared` directory is used to indicate whether data has been loaded into ArangoDB. Both the python and perl containers have access to this directory.

The script `scripts/start_re_server_load_data.sh`, when run in the `re_api` container, will load the DJORNL test data set and create the appropriate file.

# Testing

## Testing using docker-compose and the test DJORNL dataset

### Non-interactive

Run `make docker-test`.

### Interactive

Run `make docker-shell` to bring up the dev setup.

Create a shell into the perl container and run

```sh
sh ./scripts/run_tests.sh
```

## Testing using kb-sdk

TODO!

# Updating metadata and UI config files

Application metadata and configuration information is stored in the file `metadata.yaml`, and the various config, spec, and metadata files are generated from this. Specifically, the following files are autogenerated:

- kb_cytoscape.spec
- kbase.yml
- ui/narrative/methods/run_kb_cytoscape/spec.json
- ui/narrative/methods/run_kb_cytoscape/display.yaml

After updating the metadata file, run `sh scripts/generate_files.sh` from within the Perl container to update the above files. Note that this command requires the docker-compose set up as it uses data from the relation engine repo.

# Frontend

The Javascript files to generate the frontend live in kb_cytoscape/js, and are built using rollup.

# Setup and test

Add your KBase developer token to `test_local/test.cfg` and run the following:

```bash
$ kb-sdk test
```

After making any additional changes to this repo, run `kb-sdk test` again to verify that everything still works.

# Installation from another module

To use this code in another SDK module, call `kb-sdk install kb_cytoscape` in the other module's root directory.

# Help

You may find the answers to your questions in our [FAQ](https://kbase.github.io/kb_sdk_docs/references/questions_and_answers.html) or [Troubleshooting Guide](https://kbase.github.io/kb_sdk_docs/references/troubleshooting.html).
